<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã M√¥ T·∫£: T·∫°o Ch·ª©ng T·ª´ K·ª≥ Sau</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section h3 {
            color: #764ba2;
            margin: 25px 0 15px 0;
            font-size: 1.3em;
        }
        
        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .code-block .keyword { color: #c678dd; }
        .code-block .string { color: #98c379; }
        .code-block .comment { color: #5c6370; font-style: italic; }
        .code-block .function { color: #61afef; }
        .code-block .variable { color: #e06c75; }
        .code-block .number { color: #d19a66; }
        
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid;
        }
        
        .alert-info {
            background: #d1ecf1;
            border-color: #0c5460;
            color: #0c5460;
        }
        
        .alert-success {
            background: #d4edda;
            border-color: #155724;
            color: #155724;
        }
        
        .alert-warning {
            background: #fff3cd;
            border-color: #856404;
            color: #856404;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            background: white;
        }
        
        table tr:hover td {
            background: #f1f3f5;
        }
        
        .flow-step {
            background: white;
            border: 2px solid #667eea;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            position: relative;
        }
        
        .flow-step::before {
            content: "‚Üì";
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: #667eea;
        }
        
        .flow-step:last-child::before {
            display: none;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 0 5px;
        }
        
        .badge-primary { background: #667eea; color: white; }
        .badge-success { background: #28a745; color: white; }
        .badge-info { background: #17a2b8; color: white; }
        .badge-warning { background: #ffc107; color: #212529; }
        
        .highlight {
            background: #fff3cd;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-item {
            padding: 20px;
            border-radius: 10px;
            border: 2px solid;
        }
        
        .before {
            background: #fff5f5;
            border-color: #667eea;
        }
        
        .after {
            background: #f5fff5;
            border-color: #28a745;
        }
        
        .example-box {
            background: #e8f5e9;
            border: 2px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã M√¥ T·∫£: T·∫°o Ch·ª©ng T·ª´ K·ª≥ Sau</h1>
            <p>Khi nh√¢n vi√™n nh·∫≠n thi·∫øt b·ªã (sl: 0 ‚Üí 1), h·ªá th·ªëng t·ª± ƒë·ªông t·∫°o ch·ª©ng t·ª´ cho k·ª≥ k·∫ø ti·∫øp</p>
            <p style="font-size: 0.9em; margin-top: 10px;">File: classes/bhld_ctctu.php | Function: Row_Updating()</p>
        </div>
        
        <div class="content">
            <!-- T·ªîNG QUAN -->
            <div class="section">
                <h2><span class="icon">üéØ</span>T·ªïng Quan</h2>
                
                <div class="alert alert-info">
                    <h3 style="margin-top: 0;">üìå Kh√°i ni·ªám "Ch·ª©ng t·ª´ k·ª≥ sau"</h3>
                    <p><strong>ƒê·ªãnh nghƒ©a:</strong> Khi nh√¢n vi√™n nh·∫≠n thi·∫øt b·ªã trong k·ª≥ hi·ªán t·∫°i, h·ªá th·ªëng t·ª± ƒë·ªông t·∫°o s·∫µn ch·ª©ng t·ª´ cho k·ª≥ k·∫ø ti·∫øp (k·ª≥ tr·∫£ thi·∫øt b·ªã).</p>
                    <br>
                    <p><strong>M·ª•c ƒë√≠ch:</strong></p>
                    <ul style="margin: 15px 0 0 30px;">
                        <li>Theo d√µi chu k·ª≥ m∆∞·ª£n-tr·∫£ thi·∫øt b·ªã</li>
                        <li>T·ª± ƒë·ªông h√≥a vi·ªác t·∫°o ch·ª©ng t·ª´ ƒë·ªãnh k·ª≥</li>
                        <li>ƒê·∫£m b·∫£o nh√¢n vi√™n tr·∫£ thi·∫øt b·ªã ƒë√∫ng h·∫°n</li>
                    </ul>
                </div>
                
                <h3>V√≠ d·ª• minh h·ªça:</h3>
                <div class="example-box">
                    <p><strong>Th√°ng 11/2024:</strong> Nh√¢n vi√™n 17542 nh·∫≠n thi·∫øt b·ªã "Kh·∫©u trang N95" (ƒë·ªãnh m·ª©c 3 th√°ng)</p>
                    <p style="margin-top: 10px;">‚Üí H·ªá th·ªëng t·ª± ƒë·ªông t·∫°o:</p>
                    <ul style="margin: 10px 0 0 30px;">
                        <li><strong>Ch·ª©ng t·ª´ hi·ªán t·∫°i (11/2024):</strong> sl=1, ngnhan='2024-11-15', ngnhantt='2025-02-15'</li>
                        <li><strong>Ch·ª©ng t·ª´ k·ª≥ sau (02/2025):</strong> sl=0, ngnhan='1911-11-11', ngnhantt='1911-11-11' (ch∆∞a nh·∫≠n)</li>
                    </ul>
                    <p style="margin-top: 10px;"><strong>√ù nghƒ©a:</strong> ƒê·∫øn th√°ng 2/2025, nh√¢n vi√™n s·∫Ω tr·∫£ thi·∫øt b·ªã c≈© v√† nh·∫≠n thi·∫øt b·ªã m·ªõi</p>
                </div>
            </div>

            <!-- LU·ªíNG X·ª¨ L√ù -->
            <div class="section">
                <h2><span class="icon">üîÑ</span>Lu·ªìng X·ª≠ L√Ω Chi Ti·∫øt</h2>
                
                <div class="flow-step">
                    <h3 style="margin-top: 0;">B∆∞·ªõc 1: User c·∫≠p nh·∫≠t sl t·ª´ 0 ‚Üí 1</h3>
                    <p>Nh√¢n vi√™n nh·∫≠n thi·∫øt b·ªã, admin s·ª≠a s·ªë l∆∞·ª£ng t·ª´ 0 (ch∆∞a nh·∫≠n) ‚Üí 1 (ƒë√£ nh·∫≠n)</p>
                    <table>
                        <tr>
                            <th>Field</th>
                            <th>Gi√° tr·ªã c≈©</th>
                            <th>Gi√° tr·ªã m·ªõi</th>
                        </tr>
                        <tr>
                            <td>sl</td>
                            <td>0</td>
                            <td>1</td>
                        </tr>
                        <tr>
                            <td>ngnhan</td>
                            <td>'1911-11-11'</td>
                            <td>(s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t)</td>
                        </tr>
                        <tr>
                            <td>ngnhantt</td>
                            <td>'1911-11-11'</td>
                            <td>(s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t)</td>
                        </tr>
                    </table>
                </div>
                
                <div class="flow-step">
                    <h3 style="margin-top: 0;">B∆∞·ªõc 2: Trigger Row_Updating()</h3>
                    <p>PHPMaker t·ª± ƒë·ªông g·ªçi function <code>Row_Updating($rsold, &$rsnew)</code></p>
                    <div class="code-block">
<span class="function">Row_Updating</span>(<span class="variable">$rsold</span>, &<span class="variable">$rsnew</span>) {
    <span class="comment">// $rsold: D·ªØ li·ªáu c≈© (sl=0)</span>
    <span class="comment">// $rsnew: D·ªØ li·ªáu m·ªõi (sl=1)</span>
}
                    </div>
                </div>
                
                <div class="flow-step">
                    <h3 style="margin-top: 0;">B∆∞·ªõc 3: L·∫•y th√¥ng tin master record</h3>
                    <div class="code-block">
<span class="variable">$rs</span> = <span class="function">ExecuteRow</span>(<span class="string">"SELECT LPAD(manv,5,0) as manv, mact, madm, mapb, ghichu, ngct, 
       Date_Format(ngct,'%Y-%m-%d') as thang 
       FROM bhld_ctu 
       WHERE mact='"</span>.<span class="variable">$rsold</span>[<span class="string">'mact'</span>].<span class="string">"'"</span>);
                    </div>
                    <p>L·∫•y th√¥ng tin ch·ª©ng t·ª´ cha (bhld_ctu) ƒë·ªÉ bi·∫øt:</p>
                    <ul style="margin-left: 30px;">
                        <li><strong>manv:</strong> M√£ nh√¢n vi√™n (format 5 ch·ªØ s·ªë)</li>
                        <li><strong>mapb:</strong> M√£ ph√≤ng ban</li>
                        <li><strong>ngct:</strong> Ng√†y ch·ª©ng t·ª´ (VD: '2024-11-15')</li>
                        <li><strong>madm:</strong> M√£ ƒë·ªãnh m·ª©c</li>
                        <li><strong>dmtg:</strong> ƒê·ªãnh m·ª©c th·ªùi gian (VD: 3 th√°ng)</li>
                    </ul>
                </div>
                
                <div class="flow-step">
                    <h3 style="margin-top: 0;">B∆∞·ªõc 4A: C·∫≠p nh·∫≠t ng√†y nh·∫≠n cho record HI·ªÜN T·∫†I</h3>
                    <div class="code-block">
<span class="comment">// 1. C·∫¨P NH·∫¨T NG√ÄY NH·∫¨N CHO RECORD HI·ªÜN T·∫†I (lu√¥n ch·∫°y)</span>
<span class="variable">$ngaynhan</span> = <span class="variable">$rs</span>[<span class="string">'ngct'</span>];  <span class="comment">// L·∫•y ng√†y t·ª´ master</span>
<span class="variable">$ngnhantt</span> = <span class="function">date</span>(<span class="string">'Y-m-d'</span>, <span class="function">strtotime</span>(<span class="variable">$ngaynhan</span>.<span class="string">' + '</span>.<span class="variable">$rsold</span>[<span class="string">'dmtg'</span>].<span class="string">' month'</span>));

<span class="variable">$rsnew</span>[<span class="string">'ngnhan'</span>] = <span class="variable">$ngaynhan</span>;      <span class="comment">// VD: '2024-11-15'</span>
<span class="variable">$rsnew</span>[<span class="string">'ngnhantt'</span>] = <span class="variable">$ngnhantt</span>;  <span class="comment">// VD: '2025-02-15' (11/15 + 3 th√°ng)</span>
                    </div>
                    <div class="alert alert-success">
                        <strong>‚úÖ Quan tr·ªçng:</strong> Code n√†y ch·∫°y LU√îN, kh√¥ng ph·ª• thu·ªôc session!
                    </div>
                </div>
                
                <div class="flow-step">
                    <h3 style="margin-top: 0;">B∆∞·ªõc 4B: X√°c ƒë·ªãnh ng√†y cho ch·ª©ng t·ª´ k·ª≥ sau</h3>
                    <div class="code-block">
<span class="comment">// 2. T·∫†O CH·ª®NG T·ª™ K·ª≤ SAU</span>
<span class="comment">// QUAN TR·ªåNG: S·ª≠ d·ª•ng ngnhan, KH√îNG PH·∫¢I ngct</span>
<span class="variable">$ngaynhan_future</span> = <span class="variable">$rsnew</span>[<span class="string">'ngnhan'</span>];  <span class="comment">// VD: '2024-11-15'</span>
                    </div>
                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è LOGIC QUAN TR·ªåNG:</strong><br>
                        <strong>‚úÖ ƒê√öNG:</strong> ngct k·ª≥ sau = <code>ngnhan + dmtg</code> (ng√†y nh·∫≠n th·ª±c t·∫ø + ƒë·ªãnh m·ª©c)<br>
                        <strong>‚ùå SAI:</strong> ngct k·ª≥ sau = <code>ngct + dmtg</code> (ng√†y ch·ª©ng t·ª´ + ƒë·ªãnh m·ª©c)<br><br>
                        <strong>Gi·∫£i th√≠ch:</strong> Ph·∫£i d√πng <code>ngnhan</code> (ng√†y nh·∫≠n th·ª±c t·∫ø) v√¨ ƒë√¢y l√† ng√†y nh√¢n vi√™n th·ª±c s·ª± nh·∫≠n thi·∫øt b·ªã, n√™n ng√†y tr·∫£ k·ª≥ sau ph·∫£i t√≠nh t·ª´ ng√†y n√†y.
                    </div>
                </div>
                
                <div class="flow-step">
                    <h3 style="margin-top: 0;">B∆∞·ªõc 5: INSERT master record k·ª≥ sau (bhld_ctu)</h3>
                    <div class="code-block">
<span class="variable">$sql</span> = <span class="string">"INSERT IGNORE INTO `bhld_ctu`
       (`mact`, `manv`, `ngct`, `mapb`, `ghichu`, `madm`)
       VALUES(
           CONCAT(
               date_format(DATE_ADD('"</span>.<span class="variable">$ngaynhan_future</span>.<span class="string">"', INTERVAL "</span>.<span class="variable">$rsold</span>[<span class="string">'dmtg'</span>].<span class="string">" MONTH), '%Y-%m'),
               '-', '"</span>.<span class="variable">$rs</span>[<span class="string">'mapb'</span>].<span class="string">"',
               '-', LPAD('"</span>.<span class="variable">$rs</span>[<span class="string">'manv'</span>].<span class="string">"', 5, 0)
           ),
           '"</span>.<span class="variable">$rs</span>[<span class="string">'manv'</span>].<span class="string">"',
           DATE_ADD('"</span>.<span class="variable">$ngaynhan_future</span>.<span class="string">"', INTERVAL "</span>.<span class="variable">$rsold</span>[<span class="string">'dmtg'</span>].<span class="string">" MONTH),
           '"</span>.<span class="variable">$rs</span>[<span class="string">'mapb'</span>].<span class="string">"',
           '"</span>.<span class="variable">$rs</span>[<span class="string">'ghichu'</span>].<span class="string">"',
           '"</span>.<span class="variable">$rs</span>[<span class="string">'madm'</span>].<span class="string">"'
       )"</span>;
<span class="function">Execute</span>(<span class="variable">$sql</span>);
                    </div>
                    
                    <h4>Gi·∫£i th√≠ch c√°c field:</h4>
                    <table>
                        <tr>
                            <th>Field</th>
                            <th>Formula</th>
                            <th>V√≠ d·ª•</th>
                        </tr>
                        <tr>
                            <td><strong>mact</strong></td>
                            <td>date_format(DATE_ADD('2024-11-15', 3 MONTH), '%Y-%m') + '-PB01-17542'</td>
                            <td><span class="badge badge-primary">2025-02-PB01-17542</span></td>
                        </tr>
                        <tr>
                            <td><strong>manv</strong></td>
                            <td>M√£ nh√¢n vi√™n t·ª´ $rs['manv']</td>
                            <td><span class="badge badge-info">17542</span></td>
                        </tr>
                        <tr>
                            <td><strong>ngct</strong></td>
                            <td>DATE_ADD('2024-11-15', 3 MONTH)</td>
                            <td><span class="badge badge-success">2025-02-15</span></td>
                        </tr>
                        <tr>
                            <td><strong>mapb</strong></td>
                            <td>M√£ ph√≤ng ban t·ª´ $rs['mapb']</td>
                            <td><span class="badge badge-info">PB01</span></td>
                        </tr>
                        <tr>
                            <td><strong>ghichu</strong></td>
                            <td>Copy t·ª´ ch·ª©ng t·ª´ hi·ªán t·∫°i</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><strong>madm</strong></td>
                            <td>M√£ ƒë·ªãnh m·ª©c t·ª´ $rs['madm']</td>
                            <td><span class="badge badge-info">DM001</span></td>
                        </tr>
                    </table>
                    
                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è L∆∞u √Ω:</strong> D√πng <code>INSERT IGNORE</code> ƒë·ªÉ tr√°nh l·ªói n·∫øu ch·ª©ng t·ª´ k·ª≥ sau ƒë√£ t·ªìn t·∫°i
                    </div>
                </div>
                
                <div class="flow-step">
                    <h3 style="margin-top: 0;">B∆∞·ªõc 6: INSERT detail record k·ª≥ sau (bhld_ctctu)</h3>
                    <div class="code-block">
<span class="variable">$sql</span> = <span class="string">"INSERT INTO `bhld_ctctu`
       (`mact`, `mavt`, `sl`, `ngnhan`, `ngnhantt`, `dmtg`)
       VALUES(
           CONCAT(
               date_format(DATE_ADD('"</span>.<span class="variable">$ngaynhan_future</span>.<span class="string">"', INTERVAL "</span>.<span class="variable">$rsold</span>[<span class="string">'dmtg'</span>].<span class="string">" MONTH), '%Y-%m'),
               '-', '"</span>.<span class="variable">$rs</span>[<span class="string">'mapb'</span>].<span class="string">"',
               '-', LPAD('"</span>.<span class="variable">$rs</span>[<span class="string">'manv'</span>].<span class="string">"', 5, 0)
           ),
           "</span>.<span class="variable">$rsold</span>[<span class="string">'mavt'</span>].<span class="string">",
           0,
           '1911-11-11',
           '1911-11-11',
           "</span>.<span class="variable">$rsold</span>[<span class="string">'dmtg'</span>].<span class="string">"
       )"</span>;
<span class="function">Execute</span>(<span class="variable">$sql</span>);
                    </div>
                    
                    <h4>Gi·∫£i th√≠ch c√°c field:</h4>
                    <table>
                        <tr>
                            <th>Field</th>
                            <th>Gi√° tr·ªã</th>
                            <th>√ù nghƒ©a</th>
                        </tr>
                        <tr>
                            <td><strong>mact</strong></td>
                            <td>2025-02-PB01-17542</td>
                            <td>Kh√≥a ngo·∫°i li√™n k·∫øt v·ªõi bhld_ctu</td>
                        </tr>
                        <tr>
                            <td><strong>mavt</strong></td>
                            <td>VD: 101 (Kh·∫©u trang N95)</td>
                            <td>M√£ v·∫≠t t∆∞ t·ª´ record hi·ªán t·∫°i</td>
                        </tr>
                        <tr>
                            <td><strong>sl</strong></td>
                            <td class="highlight">0</td>
                            <td>Ch∆∞a nh·∫≠n (s·∫Ω update khi ƒë·∫øn k·ª≥)</td>
                        </tr>
                        <tr>
                            <td><strong>ngnhan</strong></td>
                            <td class="highlight">'1911-11-11'</td>
                            <td>Ng√†y m·∫∑c ƒë·ªãnh (ch∆∞a nh·∫≠n)</td>
                        </tr>
                        <tr>
                            <td><strong>ngnhantt</strong></td>
                            <td class="highlight">'1911-11-11'</td>
                            <td>Ng√†y m·∫∑c ƒë·ªãnh (ch∆∞a nh·∫≠n)</td>
                        </tr>
                        <tr>
                            <td><strong>dmtg</strong></td>
                            <td>3</td>
                            <td>ƒê·ªãnh m·ª©c th·ªùi gian (th√°ng)</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- V√ç D·ª§ C·ª§ TH·ªÇ -->
            <div class="section">
                <h2><span class="icon">üí°</span>V√≠ D·ª• C·ª• Th·ªÉ</h2>
                
                <h3>T√¨nh hu·ªëng: Nh√¢n vi√™n 17542 nh·∫≠n Kh·∫©u trang N95</h3>
                
                <table>
                    <tr>
                        <th style="width: 20%;">Th√¥ng tin</th>
                        <th>Gi√° tr·ªã</th>
                    </tr>
                    <tr>
                        <td><strong>Nh√¢n vi√™n</strong></td>
                        <td>17542 (Nguy·ªÖn VƒÉn A)</td>
                    </tr>
                    <tr>
                        <td><strong>Ph√≤ng ban</strong></td>
                        <td>PB01</td>
                    </tr>
                    <tr>
                        <td><strong>V·∫≠t t∆∞</strong></td>
                        <td>101 - Kh·∫©u trang N95</td>
                    </tr>
                    <tr>
                        <td><strong>ƒê·ªãnh m·ª©c</strong></td>
                        <td>3 th√°ng</td>
                    </tr>
                    <tr>
                        <td><strong>Ng√†y nh·∫≠n</strong></td>
                        <td>15/11/2024</td>
                    </tr>
                </table>
                
                <h3>üìä D·ªØ li·ªáu TR∆Ø·ªöC khi update (sl: 0 ‚Üí 1):</h3>
                
                <h4>B·∫£ng bhld_ctu (Master):</h4>
                <table>
                    <tr>
                        <th>mact</th>
                        <th>manv</th>
                        <th>ngct</th>
                        <th>mapb</th>
                        <th>madm</th>
                    </tr>
                    <tr>
                        <td>2024-11-PB01-17542</td>
                        <td>17542</td>
                        <td>2024-11-15</td>
                        <td>PB01</td>
                        <td>DM001</td>
                    </tr>
                </table>
                
                <h4>B·∫£ng bhld_ctctu (Detail):</h4>
                <table>
                    <tr>
                        <th>mact</th>
                        <th>mavt</th>
                        <th>sl</th>
                        <th>ngnhan</th>
                        <th>ngnhantt</th>
                        <th>dmtg</th>
                    </tr>
                    <tr style="background: #fff3cd;">
                        <td>2024-11-PB01-17542</td>
                        <td>101</td>
                        <td class="highlight">0</td>
                        <td class="highlight">1911-11-11</td>
                        <td class="highlight">1911-11-11</td>
                        <td>3</td>
                    </tr>
                </table>
                
                <h3>üìä D·ªØ li·ªáu SAU khi update (sl: 0 ‚Üí 1):</h3>
                
                <h4>B·∫£ng bhld_ctu (Master) - C√≥ th√™m record m·ªõi:</h4>
                <table>
                    <tr>
                        <th>mact</th>
                        <th>manv</th>
                        <th>ngct</th>
                        <th>mapb</th>
                        <th>madm</th>
                        <th>Ghi ch√∫</th>
                    </tr>
                    <tr>
                        <td>2024-11-PB01-17542</td>
                        <td>17542</td>
                        <td>2024-11-15</td>
                        <td>PB01</td>
                        <td>DM001</td>
                        <td><span class="badge badge-info">K·ª≥ hi·ªán t·∫°i</span></td>
                    </tr>
                    <tr style="background: #e8f5e9;">
                        <td><strong>2025-02-PB01-17542</strong></td>
                        <td>17542</td>
                        <td><strong>2025-02-15</strong></td>
                        <td>PB01</td>
                        <td>DM001</td>
                        <td><span class="badge badge-success">K·ª≥ sau (m·ªõi t·∫°o)</span></td>
                    </tr>
                </table>
                
                <h4>B·∫£ng bhld_ctctu (Detail) - C√≥ th√™m record m·ªõi:</h4>
                <table>
                    <tr>
                        <th>mact</th>
                        <th>mavt</th>
                        <th>sl</th>
                        <th>ngnhan</th>
                        <th>ngnhantt</th>
                        <th>dmtg</th>
                        <th>Ghi ch√∫</th>
                    </tr>
                    <tr style="background: #fff3cd;">
                        <td>2024-11-PB01-17542</td>
                        <td>101</td>
                        <td><strong>1</strong></td>
                        <td><strong>2024-11-15</strong></td>
                        <td><strong>2025-02-15</strong></td>
                        <td>3</td>
                        <td><span class="badge badge-warning">ƒê√£ c·∫≠p nh·∫≠t</span></td>
                    </tr>
                    <tr style="background: #e8f5e9;">
                        <td><strong>2025-02-PB01-17542</strong></td>
                        <td>101</td>
                        <td><strong>0</strong></td>
                        <td>1911-11-11</td>
                        <td>1911-11-11</td>
                        <td>3</td>
                        <td><span class="badge badge-success">K·ª≥ sau (m·ªõi t·∫°o)</span></td>
                    </tr>
                </table>
            </div>

            <!-- LOGIC T√çNH TO√ÅN -->
            <div class="section">
                <h2><span class="icon">üßÆ</span>Logic T√≠nh To√°n Ng√†y Th√°ng</h2>
                
                <h3>C√¥ng th·ª©c t√≠nh mact cho k·ª≥ sau:</h3>
                <div class="code-block">
<span class="function">date_format</span>(<span class="function">DATE_ADD</span>(<span class="string">'2024-11-15'</span>, <span class="keyword">INTERVAL</span> <span class="number">3</span> <span class="keyword">MONTH</span>), <span class="string">'%Y-%m'</span>)
‚Üì
<span class="function">date_format</span>(<span class="string">'2025-02-15'</span>, <span class="string">'%Y-%m'</span>)
‚Üì
<span class="string">'2025-02'</span>
‚Üì
<span class="string">'2025-02'</span> + <span class="string">'-'</span> + <span class="string">'PB01'</span> + <span class="string">'-'</span> + <span class="function">LPAD</span>(<span class="string">'17542'</span>, <span class="number">5</span>, <span class="string">'0'</span>)
‚Üì
<span class="highlight">'2025-02-PB01-17542'</span>
                </div>
                
                <h3>B·∫£ng t√≠nh to√°n chi ti·∫øt:</h3>
                <table>
                    <tr>
                        <th>Bi·∫øn</th>
                        <th>C√¥ng th·ª©c</th>
                        <th>K·∫øt qu·∫£</th>
                        <th>Ghi ch√∫</th>
                    </tr>
                    <tr>
                        <td><strong>$ngaynhan_future</strong></td>
                        <td>$rsnew['ngnhan'] (t·ª´ B∆∞·ªõc 4A)</td>
                        <td>2024-11-15</td>
                        <td><span class="badge badge-warning">D√πng ngnhan!</span></td>
                    </tr>
                    <tr>
                        <td><strong>$rsold['dmtg']</strong></td>
                        <td>ƒê·ªãnh m·ª©c th·ªùi gian</td>
                        <td>3 (th√°ng)</td>
                        <td>-</td>
                    </tr>
                    <tr style="background: #fff3cd;">
                        <td><strong>ngct k·ª≥ sau</strong></td>
                        <td><strong>DATE_ADD(ngnhan, dmtg MONTH)</strong></td>
                        <td><strong>2025-02-15</strong></td>
                        <td><span class="badge badge-success">KH√îNG d√πng ngct!</span></td>
                    </tr>
                    <tr>
                        <td><strong>NƒÉm-th√°ng</strong></td>
                        <td>date_format('2025-02-15', '%Y-%m')</td>
                        <td>2025-02</td>
                    </tr>
                    <tr>
                        <td><strong>manv format</strong></td>
                        <td>LPAD('17542', 5, '0')</td>
                        <td>17542 (ƒë√£ ƒë·ªß 5 k√Ω t·ª±)</td>
                    </tr>
                    <tr>
                        <td><strong>mact final</strong></td>
                        <td>'2025-02' + '-' + 'PB01' + '-' + '17542'</td>
                        <td class="highlight">2025-02-PB01-17542</td>
                    </tr>
                </table>
            </div>

            <!-- TR∆Ø·ªúNG H·ª¢P ƒê·∫∂C BI·ªÜT -->
            <div class="section">
                <h2><span class="icon">‚ö†Ô∏è</span>C√°c Tr∆∞·ªùng H·ª£p ƒê·∫∑c Bi·ªát</h2>
                
                <h3>1. M√£ nh√¢n vi√™n c√≥ k√Ω t·ª± ƒë·∫∑c bi·ªát (99-DVL, 07-DVL):</h3>
                <div class="comparison">
                    <div class="comparison-item before">
                        <h4>‚ùå Logic C≈© (SAI)</h4>
                        <div class="code-block">
<span class="keyword">if</span>(<span class="function">strlen</span>(<span class="variable">$manv</span>)==<span class="number">4</span>)
    <span class="variable">$mact</span> = <span class="string">'...-0'</span>.<span class="variable">$manv</span>;
                        </div>
                        <p>‚ùå "99-DVL" (6 k√Ω t·ª±) ‚Üí Kh√¥ng th√™m 0 ‚Üí SAI format</p>
                    </div>
                    
                    <div class="comparison-item after">
                        <h4>‚úÖ Logic M·ªõi (ƒê√öNG)</h4>
                        <div class="code-block">
<span class="keyword">if</span>(<span class="function">is_numeric</span>(<span class="variable">$manv</span>) && <span class="function">strlen</span>(<span class="variable">$manv</span>)==<span class="number">4</span>)
    <span class="variable">$mact</span> = <span class="string">'...-0'</span>.<span class="variable">$manv</span>;
                        </div>
                        <p>‚úÖ "99-DVL" (kh√¥ng ph·∫£i s·ªë) ‚Üí Gi·ªØ nguy√™n ‚Üí ƒê√öNG</p>
                    </div>
                </div>
                
                <h3>2. Logic t√≠nh ng√†y k·ª≥ sau - QUAN TR·ªåNG:</h3>
                <div class="comparison">
                    <div class="comparison-item before">
                        <h4>‚ùå Logic SAI</h4>
                        <div class="code-block">
<span class="comment">// SAI: D√πng ngct (ng√†y ch·ª©ng t·ª´)</span>
<span class="variable">ngct_k·ª≥_sau</span> = <span class="function">DATE_ADD</span>(<span class="variable">ngct</span>, <span class="keyword">INTERVAL</span> <span class="variable">dmtg</span> <span class="keyword">MONTH</span>)
                        </div>
                        <p>‚ùå N·∫øu nh√¢n vi√™n nh·∫≠n mu·ªôn h∆°n ngct ‚Üí K·ª≥ sau sai!</p>
                    </div>
                    
                    <div class="comparison-item after">
                        <h4>‚úÖ Logic ƒê√öNG</h4>
                        <div class="code-block">
<span class="comment">// ƒê√öNG: D√πng ngnhan (ng√†y nh·∫≠n th·ª±c t·∫ø)</span>
<span class="variable">ngct_k·ª≥_sau</span> = <span class="function">DATE_ADD</span>(<span class="variable">ngnhan</span>, <span class="keyword">INTERVAL</span> <span class="variable">dmtg</span> <span class="keyword">MONTH</span>)
                        </div>
                        <p>‚úÖ Lu√¥n t√≠nh t·ª´ ng√†y nh·∫≠n th·ª±c t·∫ø ‚Üí Ch√≠nh x√°c!</p>
                        <p><strong>V√≠ d·ª•:</strong> ngnhan='2024-11-15', dmtg=3 ‚Üí '2025-02-15'</p>
                    </div>
                </div>
                
                <h3>3. Ch·ª©ng t·ª´ k·ª≥ sau ƒë√£ t·ªìn t·∫°i:</h3>
                <div class="alert alert-info">
                    <p><strong>üîç X·ª≠ l√Ω:</strong> D√πng <code>INSERT IGNORE</code> ƒë·ªÉ b·ªè qua n·∫øu mact ƒë√£ t·ªìn t·∫°i</p>
                    <p style="margin-top: 10px;"><strong>L√Ω do:</strong> Tr√°nh l·ªói duplicate key khi user update nhi·ªÅu l·∫ßn</p>
                </div>
                
                <h3>4. ƒê·ªãnh m·ª©c th·ªùi gian kh√°c nhau:</h3>
                <table>
                    <tr>
                        <th>V·∫≠t t∆∞</th>
                        <th>ƒê·ªãnh m·ª©c (th√°ng)</th>
                        <th>Ng√†y nh·∫≠n</th>
                        <th>Ng√†y h·∫πn tr·∫£</th>
                        <th>K·ª≥ sau</th>
                    </tr>
                    <tr>
                        <td>Kh·∫©u trang N95</td>
                        <td>3</td>
                        <td>15/11/2024</td>
                        <td>15/02/2025</td>
                        <td>2025-02</td>
                    </tr>
                    <tr>
                        <td>GƒÉng tay</td>
                        <td>1</td>
                        <td>15/11/2024</td>
                        <td>15/12/2024</td>
                        <td>2024-12</td>
                    </tr>
                    <tr>
                        <td>√Åo b·∫£o h·ªô</td>
                        <td>6</td>
                        <td>15/11/2024</td>
                        <td>15/05/2025</td>
                        <td>2025-05</td>
                    </tr>
                </table>
            </div>

            <!-- T√ìM T·∫ÆT -->
            <div class="section">
                <h2><span class="icon">üìù</span>T√≥m T·∫Øt</h2>
                
                <div class="alert alert-success">
                    <h3 style="margin-top: 0;">‚úÖ ƒêi·ªÉm ch√≠nh v·ªÅ "T·∫°o ch·ª©ng t·ª´ k·ª≥ sau":</h3>
                    <ol style="margin: 15px 0 0 30px;">
                        <li><strong>T·ª± ƒë·ªông h√≥a:</strong> Khi nh√¢n vi√™n nh·∫≠n thi·∫øt b·ªã (sl: 0‚Üí1), h·ªá th·ªëng t·ª± ƒë·ªông t·∫°o ch·ª©ng t·ª´ cho k·ª≥ tr·∫£</li>
                        <li><strong>C·∫•u tr√∫c 2 t·∫ßng:</strong> T·∫°o c·∫£ master (bhld_ctu) v√† detail (bhld_ctctu)</li>
                        <li style="background: #fff3cd; padding: 5px; border-radius: 5px;"><strong>‚ö†Ô∏è C√îNG TH·ª®C QUAN TR·ªåNG:</strong> <code>ngct k·ª≥ sau = ngnhan + dmtg</code><br>
                            ‚Üí Ph·∫£i d√πng <strong>ngnhan</strong> (ng√†y nh·∫≠n th·ª±c t·∫ø), KH√îNG d√πng ngct (ng√†y ch·ª©ng t·ª´)</li>
                        <li><strong>Tr·∫°ng th√°i ban ƒë·∫ßu:</strong> sl=0, ngnhan='1911-11-11' (ch∆∞a nh·∫≠n)</li>
                        <li><strong>ƒê∆°n gi·∫£n:</strong> S·ª≠ d·ª•ng ngnhan t·ª´ record hi·ªán t·∫°i ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t ·ªü B∆∞·ªõc 4A</li>
                        <li><strong>An to√†n:</strong> D√πng INSERT IGNORE ƒë·ªÉ tr√°nh duplicate</li>
                    </ol>
                </div>
                
                <div class="alert alert-warning">
                    <h3 style="margin-top: 0;">‚ö†Ô∏è L∆∞u √Ω khi maintain:</h3>
                    <ul style="margin: 15px 0 0 30px;">
                        <li><strong style="color: #d9534f;">QUAN TR·ªåNG NH·∫§T:</strong> Lu√¥n d√πng c√¥ng th·ª©c <code>ngct k·ª≥ sau = ngnhan + dmtg</code>, KH√îNG d√πng <code>ngct + dmtg</code></li>
                        <li>ƒê·∫£m b·∫£o logic LPAD() x·ª≠ l√Ω ƒë√∫ng m√£ c√≥/kh√¥ng c√≥ k√Ω t·ª± ƒë·∫∑c bi·ªát</li>
                        <li>ƒê·∫£m b·∫£o ngnhan ƒë∆∞·ª£c c·∫≠p nh·∫≠t ch√≠nh x√°c ·ªü B∆∞·ªõc 4A tr∆∞·ªõc khi t√≠nh k·ª≥ sau</li>
                        <li>Verify ƒë·ªãnh m·ª©c th·ªùi gian (dmtg) ƒë√∫ng v·ªõi t·ª´ng lo·∫°i v·∫≠t t∆∞</li>
                        <li>Test v·ªõi nhi·ªÅu tr∆∞·ªùng h·ª£p: manv s·ªë thu·∫ßn, manv c√≥ k√Ω t·ª±, dmtg kh√°c nhau</li>
                        <li>Log SQL query n·∫øu INSERT fail ƒë·ªÉ debug</li>
                    </ul>
                </div>
                
                <h3>File li√™n quan:</h3>
                <ul style="margin-left: 30px;">
                    <li><strong>classes/bhld_ctctu.php</strong> - Row_Updating() (Line ~1132-1220)</li>
                    <li><strong>classes/bhld_ctu.php</strong> - Row_Inserting() (x·ª≠ l√Ω mact v·ªõi LPAD)</li>
                    <li><strong>B·∫£ng bhld_ctu</strong> - Master table (ch·ª©ng t·ª´)</li>
                    <li><strong>B·∫£ng bhld_ctctu</strong> - Detail table (chi ti·∫øt v·∫≠t t∆∞)</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
